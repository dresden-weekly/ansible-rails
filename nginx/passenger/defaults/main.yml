passenger_max_pool_size: 30
# variables for all apps in /etc/nginx/conf.d/passenger.conf
passenger_main_variables:
  passenger_max_pool_size: "{{passenger_max_pool_size}}"
  passenger_pool_idle_time: 0
  passenger_root: "/usr/lib/ruby/vendor_ruby/phusion_passenger/locations.ini"
  passenger_ruby: "/usr/bin/passenger_free_ruby"

# variables for app /etc/nginx/sites_enabled/site
passenger_variables:
  passenger_enabled: "on"
  passenger_ruby: "/home/{{app_user}}/.rvm/wrappers/ruby-{{ruby_version}}/ruby"
  passenger_min_instances: 1
  passenger_max_preloader_idle_time: 0

# Remove identifing headers like Passenger + Nginx version
passenger_cloak_headers: true

# one or more hosts, like
# app_hosts: "www.example.com example.com en.example.com de.example.de"
app_hosts: "{{app_domain}}"

nginx_config_file: "{{app_name}}.conf"

# Nginx Regex for paths that should be cached by clients for 7 days
nginx_public_folder_to_cache: '^/(system|uploads|video|packs)/'
nginx_max_body_size: 200M

# see: https://github.com/SamSaffron/message_bus#passenger
passenger_enable_message_bus: false
# https://www.phusionpassenger.com/library/config/nginx/action_cable_integration/#running-the-action-cable-server-on-the-same-host-and-port-under-a-sub-uri
passenger_enable_action_cable: false

nginx_gzip_types: 'text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript image/x-icon'

nginx_install_from_passenger_repo: yes

nginx_install_packages:
- passenger

nginx_worker_processes: 8
nginx_worker_connections: 512
nginx_keepalive: 65
nginx_main_log_format: |
  log_format main '$remote_addr - $http_x_forwarded_for - $remote_user [$time_local] '
          '"$request_method $scheme://$host$request_uri $server_protocol" '
          '$status $body_bytes_sent "$http_referer" '
          '"$http_user_agent" $request_time';

nginx_conf_d:
  gzip:
    - gzip on
    - gzip_disable "msie6"
    - gzip_vary on
    - gzip_proxied any
    - gzip_types {{nginx_gzip_types}}
  privacy:
    - "more_clear_headers 'X-Powered-By'"
    - "more_clear_headers 'X-Request-Id'"
    - "more_clear_headers 'X-Runtime'"
    - "more_set_headers 'Server: nginx'"
    - "server_tokens off"
  proxy:
    - proxy_set_header X-Real-IP  $remote_addr
    - proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for
    - proxy_set_header Host $http_host
    - proxy_set_header X-Forwarded-Proto $scheme
  log:
    - "{{nginx_main_log_format}}"

nginx_conf_extra: {}
